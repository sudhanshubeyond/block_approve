define(["jquery","core/ajax","core/templates","core/notification",],function(e,a,t,i){return{reviews:function(){function t(){document.querySelectorAll(".clickable-feedback").forEach(e=>{let a=e.nextElementSibling;e.addEventListener("click",e=>{e.stopPropagation(),document.querySelectorAll(".feedback-box").forEach(e=>{e!==a&&(e.style.display="none")}),a.style.display="block"===a.style.display?"none":"block"})})}t(),document.addEventListener("click",e=>{document.querySelectorAll(".clickable-feedback").forEach(a=>{let t=a.nextElementSibling;t.contains(e.target)||e.target===a||(t.style.display="none")})}),e(document).on("click",".page-link",function(r){r.preventDefault();var n=e(this).attr("href"),o=l("page",n);if(o){var s=e('<img style="display: block; margin-left: 750px;" />').attr("src",M.util.image_url("i/loading","core")).addClass("spinner");e(".allreviews-display").html('<tr> <td colspan="8">'+s.get(0).outerHTML+"</td></tr>"),a.call([{methodname:"block_vlearn_reviews_get_reviews",args:{page:o}},])[0].done(function(a){e(".allreviews-display").html(a.displayhtml),t()}).fail(i.exception)}}),e(document).on("keyup",".activity-search",r(function(t){t.preventDefault();var r=window.location.href,n=e(".activity-search").val();l("page",r);var o={pix:M.util.image_url("i/loading","core"),component:"moodle"},s=e("<img />").attr("src",M.util.image_url(o.pix,o.component)).addClass("spinner");e(".allreviews-display").html('<div class="text-center">'+s.get(0).outerHTML+"</div>"),a.call([{methodname:"block_vlearn_reviews_get_reviews",args:{activityname:n,page:0}},])[0].done(function(a){e(".allreviews-display").html(a.displayhtml)}).fail(i.exception)},1e3)),e(document).on("change",".batchsearch, .coursesearch, .assigntype",r(function(t){t.preventDefault();var r=window.location.href;e(".activity-search").val();var n=e("#batchsearch_id").find(":selected").val(),o=e("#coursesearch_id").find(":selected").val(),s=e("#assigntype_id").find(":selected").val();"Batch"===n&&(n=""),"Course"===o&&(o=""),"Classification"===s&&(s=""),l("page",r);var c={pix:M.util.image_url("i/loading","core"),component:"moodle"},d=e("<img />").attr("src",M.util.image_url(c.pix,c.component)).addClass("spinner");e(".allreviews-display").html('<div class="text-center">'+d.get(0).outerHTML+"</div>"),a.call([{methodname:"block_vlearn_reviews_get_reviews",args:{program:n,cid:o,type:s,page:0,duesorting:""}},])[0].done(function(a){e(".allreviews-display").html(a.displayhtml),""!==n&&e(".coursesearch").html(a.options)}).fail(i.exception)},1e3)),e(document).on("click",".down-arrow",r(function(t){t.preventDefault();var r=window.location.href,n=e("#batchsearch_id").find(":selected").val(),o=e("#coursesearch_id").find(":selected").val(),s=e("#assigntype_id").find(":selected").val(),c=e(this).attr("val");"asc"===c?(c="desc",e(".down-arrow").addClass("custom-up"),e(this).attr("val","desc")):"desc"===c&&(c="asc",e(".down-arrow").removeClass("custom-up"),e(this).attr("val","asc")),"Batch"===n&&(n=""),"Course"===o&&(o=""),"Classification"===s&&(s=""),l("page",r);var d={pix:M.util.image_url("i/loading","core"),component:"moodle"},p=e('<img style="display: block;margin: 100px auto" />').attr("src",M.util.image_url(d.pix,d.component)).addClass("spinner");e(".sorted_data").html('<tr> <td colspan="8">'+p.get(0).outerHTML+"</td></tr>"),a.call([{methodname:"block_vlearn_reviews_get_reviews",args:{program:n,cid:o,type:s,page:0,duesorting:c}},])[0].done(function(a){e(".sorted_data").html(a.displayhtml),e(".pagination-nav-filter").html(a.pagedata)}).fail(i.exception)},1e3)),e(document).on("click","#grade_popup",r(function(t){var i=e(this).attr("data-programid"),l=e(this).attr("data-id"),r=e(this).attr("cmid");a.call([{methodname:"block_vlearn_reviews_get_pending_submissions",args:{programid:i,instanceid:l,cmid:r}},])[0].done(function(a){e(".custom-modal").html(a.displayhtml),e("#exampleModal").modal("show")})},1e3))}};function l(e,a){return decodeURIComponent((RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(a)||[null,""])[1].replace(/\+/g,"%20"))||null}function r(e,a){var t=0;return function(){var i=this,l=arguments;clearTimeout(t),t=setTimeout(function(){e.apply(i,l)},a||0)}}});